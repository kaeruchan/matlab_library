clear all;
close all;
clc;
%syms
%syms r;
%r = 0:5:100;
%alpha = 0.05:0.05:0.9;
alpha = 0.2;
eta = 0.9;
h = 500;
R = 1;
Radious=200;
kappa = 1.3;
r = Radious;
Power= 0:30;
Pn = -150;
m = 3;
K_h = 5;  %Rician factors
K_g = 5;
finalresult9 = zeros(1, length(Power));
finalresult3 = zeros(1, length(Power));
finalresult6 = zeros(1,length(Power));
for pIndex=1:length(Power)
    outPut=0;
 %   for r=0:1:(Radious)
        myZ=0;
        z1=0;
        z2=0;
        for n = 0 : 10
            for p = 0 : 10
                
                %expressions
                %Power(pIndex)
                p0 = 10.^(-3)*10.^(0.1*Power(pIndex));
                pn = 10.^(-3)*10.^(0.1*Pn);
                L = (2^(R/(1-alpha))-1)/kappa/eta*(1-alpha)/(alpha)*pn/p0;
                Z = sqrt(L*(h^2+(r)^2)^m);
                a = 4*(K_h+1)*(K_g+1)*exp(-(K_g+K_h));
                G = K_g^n*K_h^p/(factorial(n)*factorial(p))^2 ...
                    *sqrt(((K_h+1)*(K_g+1))^(n+p));
                b = 2*sqrt((K_h+1)*(K_g+1));


                z2 = a * G * Z^(2*p+2) *2^(n-p-2) *b^(p-n) ...
                    * MeijerG(-p,[],[n-p,0],-p-1,b^2*Z^2/4)+z2

            end
        end
        %outPut = (r/(length(r))/ Radious^2) * z2/length(r)*4 + outPut
  %  end
    finalresult9(pIndex) =  z2;
end


%simulation

%for pIndex = 1:length(alpha)
for pIndex=1:length(Power)
    out=0;
    out2=0;
    for n=0:100000      
        %expressions
       
        p0 = 10.^(-3)*10.^(0.1*Power(pIndex));
        pn = 10.^(-3)*10.^(0.1*Pn);
        %g_k = ricernd(sqrt(K_g/(K_g+1)),sqrt(1/(K_g+1)/2));
        %h_k = ricernd(sqrt(K_h/(K_h+1)),sqrt(1/(K_g+1)/2));
        g_k = ricernd(sqrt(K_g/(K_g+1)),sqrt(1/(K_g+1)/2));
        h_k = ricernd(sqrt(K_h/(K_h+1)),sqrt(1/(K_h+1)/2));
        g_k_2 = ricernd(sqrt(K_g/(K_g+1)),sqrt(1/(K_g+1)/2));
        h_k_2 = ricernd(sqrt(K_h/(K_h+1)),sqrt(1/(K_g+1)/2));
        r_k = Radious*rand;
        L= (2^(R/(1-alpha))-1)/kappa/eta*(1-alpha)/alpha*pn/p0;
        %a=(g_k*h_k)^2/(h^2+r_k^2)^m
        %b=(2^(R/(1-alpha))-1)/kappa/eta*(1-alpha)/alpha*pn/p0
        if((g_k*h_k)^2/(h^2+r_k^2)^m < (L))
            out =out+1;
        end
        if((g_k_2*h_k_2)^2/(h^2+r_k^2)^m < (L))
            out2 =out2+1;
        end
    end
    finalresult3(pIndex) = out2/100000
    finalresult6(pIndex) = out/100000
end
%analysis alpha=0.5
finalResult = [1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,0.999990000000000,0.999960000000000,0.999690000000000,0.998310000000000,0.994760000000000,0.984370000000000,0.963410000000000,0.924080000000000,0.866040000000000,0.786000000000000,0.691180000000000,0.586720000000000,0.478880000000000,0.380670000000000,0.295530000000000,0.222670000000000,0.166180000000000,0.120460000000000,0.0872000000000000,0.0616400000000000,0.0449300000000000,0.0315500000000000,0.0230700000000000,0.0162000000000000,0.0117200000000000];
%simu. alpha =0.5   
finalresult2 = [1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,0.999980000000000,0.999740000000000,0.998420000000000,0.994350000000000,0.984540000000000,0.962230000000000,0.924710000000000,0.865960000000000,0.785750000000000,0.689660000000000,0.584290000000000,0.479340000000000,0.381350000000000,0.294420000000000,0.222630000000000,0.163450000000000,0.119370000000000,0.0867200000000000,0.0612600000000000,0.0432500000000000,0.0315400000000000,0.0231900000000000,0.0165500000000000,0.0113900000000000];
%simu alpha =0.3
%finalresult3 =  [1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,0.999980000000000,0.999780000000000,0.998970000000000,0.995640000000000,0.987520000000000,0.968100000000000,0.934810000000000,0.879440000000000,0.803860000000000,0.708000000000000,0.606820000000000,0.500050000000000,0.402250000000000,0.310250000000000,0.235200000000000,0.174510000000000,0.128520000000000,0.0921200000000000,0.0672700000000000,0.0478900000000000,0.0333900000000000,0.0237000000000000,0.0177600000000000];

%anal alpha =0.3
%finalresult6 = [1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,0.999970000000000,0.999820000000000,0.998800000000000,0.995560000000000,0.987030000000000,0.967570000000000,0.933820000000000,0.880750000000000,0.803370000000000,0.706990000000000,0.604440000000000,0.498970000000000,0.396300000000000,0.311120000000000,0.233420000000000,0.175520000000000,0.127480000000000,0.0941500000000000,0.0671600000000000,0.0469800000000000,0.0342300000000000,0.0239000000000000,0.0168200000000000];

%anal alpha = 0.8
finalresult4 = [1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,0.999990000000000,0.999960000000000,0.999730000000000,0.998400000000000,0.994800000000000,0.986000000000000,0.965980000000000,0.930700000000000,0.873930000000000,0.797870000000000,0.701720000000000,0.599370000000000,0.491820000000000,0.393880000000000,0.301170000000000,0.230020000000000,0.171670000000000,0.124930000000000,0.0907500000000000,0.0651800000000000,0.0472700000000000];
finalresult5 = [1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,1.00001000000000,0.999980000000000,0.999740000000000,0.998880000000000,0.995260000000000,0.985870000000000,0.966140000000000,0.930150000000000,0.874110000000000,0.796600000000000,0.701960000000000,0.595470000000000,0.493010000000000,0.390680000000000,0.303300000000000,0.231570000000000,0.171510000000000,0.124580000000000,0.0901300000000000,0.0645500000000000,0.0458300000000000];

%edge 
finalresult7 = [0.972797023184997,0.972797023185215,0.972797023185217,0.972797023185183,0.972797023179270,0.972797022682767,0.972797001344737,0.972796492503603,0.972789253295886,0.972723672914830,0.972322565798736,0.970576911002359,0.964911596480799,0.950619670667272,0.921552958328433,0.872356692561803,0.801131813796344,0.710813624089913,0.608435539418854,0.502865521358494,0.402324583378372,0.312727773452979,0.237164263168825,0.176255720220346,0.128928403869001,0.0932131276601759,0.0668663076624006,0.0477592625503144,0.0340697259658512,0.0243384699068328,0.0174498068831778];
finalresult8 =[1,1,1,0.970541585885353,0.972797023184094,0.972797023185216,0.972797023185215,0.972797023185200,0.972797023181921,0.972797022881411,0.972797008931648,0.972796652971765,0.972791279446448,0.972740016412832,0.972412072416514,0.970928316336134,0.965949338633991,0.953023982700331,0.926085885634166,0.879533080820392,0.810932563444317,0.722628289247945,0.621256568751144,0.515602606242382,0.414077359702962,0.322926499779235,0.245577553094470,0.182915444127669,0.134028036145578,0.0970174297262054,0.0696481109888668];
%finalresult9 = [0.970550208255394,0.972797023182320,0.972797023185216,0.972797023185216,0.972797023185203,0.972797023182883,0.972797022958952,0.972797012085376,0.972796723430403,0.972792212364122,0.972747856510746,0.972456548623097,0.971108270243867,0.966494572173359,0.954315026469299,0.928565236161609,0.883519987626867,0.816449592697410,0.729353166132592,0.628622633898184,0.522977837163699,0.420927107765718,0.328902656746536,0.250529352256673,0.186849221176247,0.137048906322626,0.0992759953804216,0.0713023930440586,0.0509572232729738,0.0363517232165312,0.0259568126382993];

finalfantasy = zeros(1,length(Power));
finalfantasy2 = zeros(1,length(Power));
clear title xlabel ylabel;
p1=semilogy(Power,finalResult,'-');
ax = gca;
ax.FontSize=16;
ax.YLim = [0.01,1];
grid on
p1.Color='Red';
%p1.DisplayName='Anal.';
%p1.MarkerSize='10';
p1.LineWidth=2;
xlabel('P_0 (dBm)','FontSize',16)
ylabel('Outage Probability','FontSize',16)


hold on
p2=semilogy(Power,finalresult2,'v');
p2.Color='Red';
p2.MarkerSize=10;
%p2.LineWidth='2';

p3=semilogy(Power,finalresult3,'*');
p3.Color='Blue';
p3.MarkerSize=10;
%p2.LineWidth='2';

p4=semilogy(Power,finalresult4,'o');
p4.Color='Green';
p4.MarkerSize=10;
%p2.LineWidth='2';

p5=semilogy(Power,finalresult5,'-');
p5.Color='Green';
p5.LineWidth=2;

p6=semilogy(Power,finalresult6,'-');
p6.Color='Blue';
p6.LineWidth=2;

p7=semilogy(Power,finalresult7,'-.');
p7.Color='Red';
p7.LineWidth=2;

p8=semilogy(Power,finalresult8,'-.');
p8.Color='Green';
p8.LineWidth=2;

p9=semilogy(Power,finalresult9,'-.');
p9.Color='Blue';
p9.LineWidth=2;

p0=semilogy(Power,finalfantasy,'-');
p0.Color='Black';
p0.LineWidth=2;

% p01=semilogy(Power,finalfantasy2,'-.');
% p01.Color='Black';
% p01.LineWidth=2;
hold off

lgd=legend([p3,p2,p4,p0],'Simu. \alpha=0.2','Simu. \alpha=0.5','Simu. \alpha=0.8','Analysis');%'Sensors at cell edge');
lgd.FontSize=16;
lgd.Location='southwest';